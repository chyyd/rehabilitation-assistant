# 康复科助手 - 生产环境启动指南

## 🚀 快速开始

### 方式一：使用菜单（推荐新手）

双击运行 **`生产环境启动.bat`**，根据提示选择操作：

```
[1] 一键启动全部 (推荐) ← 点击这个！
[2] 仅启动后端
[3] 仅启动前端
[4] 停止所有服务
...
```

### 方式二：直接运行脚本

在项目根目录打开 PowerShell 或终端：

```powershell
# 一键启动（推荐）
.\start-all.ps1

# 一键停止
.\stop-all.ps1
```

---

## 📋 所有脚本说明

| 脚本文件 | 功能 | 窗口显示 |
|---------|------|---------|
| **`start-all.ps1`** | 一键启动前后端 | ✅ 仅启动提示 |
| **`stop-all.ps1`** | 一键停止所有服务 | ✅ 显示停止状态 |
| **`start-backend.ps1`** | 仅启动后端服务 | ❌ **完全隐藏** |
| **`start-frontend.ps1`** | 仅启动前端应用 | ✅ 仅启动提示 |
| **`stop-backend.ps1`** | 停止后端服务 | ✅ 显示停止状态 |
| **`stop-frontend.ps1`** | 停止前端应用 | ✅ 显示停止状态 |

---

## 🎯 核心特性

### ✅ 后端服务完全隐藏
- 后端服务在后台运行
- 不显示任何命令行窗口
- 自动保存进程 ID 到 `.backend.pid`

### ✅ 前端应用正常显示
- Electron 应用窗口正常打开
- 启动窗口可随时关闭
- 不影响应用运行

### ✅ 智能进程管理
- 自动检测并停止旧进程
- 支持重启服务
- PID 文件自动管理

---

## 📊 服务地址

| 服务 | 地址 | 说明 |
|------|------|------|
| 后端 API | http://127.0.0.1:8000 | FastAPI 服务 |
| API 文档 | http://127.0.0.1:8000/docs | Swagger UI |
| 前端应用 | Electron 窗口 | 桌面应用 |

---

## 🔧 常见操作

### 启动应用
```powershell
.\start-all.ps1
```
✅ 后端自动在后台启动
✅ Electron 窗口自动打开
✅ 启动窗口可关闭

### 停止应用
```powershell
.\stop-all.ps1
```
✅ 自动停止前端和后端
✅ 清理 PID 文件
✅ 显示停止状态

### 重启应用
```powershell
.\stop-all.ps1
# 等待停止完成
.\start-all.ps1
```

---

## 🐛 故障排除

### 问题：后端无法启动
1. 检查 Python 版本（需要 3.13+）
   ```powershell
   python --version
   ```
2. 检查依赖是否安装
   ```powershell
   pip install -r requirements.txt
   ```
3. 检查端口 8000 是否被占用
   ```powershell
   netstat -ano | findstr :8000
   ```

### 问题：前端无法启动
1. 检查 Node.js 版本（需要 18+）
   ```powershell
   node --version
   ```
2. 检查依赖是否安装
   ```powershell
   cd electron-app
   npm install
   ```

### 问题：无法停止服务
1. 使用任务管理器结束进程：
   - `python.exe`（后端）
   - `electron.exe` 和 `node.exe`（前端）

2. 或使用强制停止命令：
   ```powershell
   taskkill /F /IM python.exe
   taskkill /F /IM electron.exe
   taskkill /F /IM node.exe
   ```

---

## 📝 文件说明

### PID 文件
进程运行时会自动创建 PID 文件：
- `.backend.pid` - 后端进程 ID
- `.frontend.pid` - 前端进程 ID

停止服务时会自动读取这些文件并停止对应进程。

### 日志文件
日志保存在 `logs/` 目录：
- `backend_YYYYMMDD_HHmmss.log` - 后端运行日志

---

## 💡 提示

1. **首次启动**可能需要安装依赖，请耐心等待
2. **后端服务**完全隐藏，不会显示任何窗口
3. **启动窗口**可以随时关闭，不影响应用运行
4. 如需**重启**，先运行停止脚本再运行启动脚本
5. 推荐使用 **`start-all.ps1`** 一键启动

---

## 📞 配置 API 密钥

编辑 `config.json` 文件：

```json
{
  "ai_services": {
    "modelscope": {
      "api_key": "你的API密钥",
      "model": "Qwen2.5-72B-Instruct"
    },
    "deepseek": {
      "api_key": "你的DeepSeek密钥",
      "model": "deepseek-chat"
    }
  }
}
```

获取 API 密钥：
- ModelScope: https://modelscope.cn/
- DeepSeek: https://platform.deepseek.com/
- Kimi (Moonshot): https://platform.moonshot.cn/

---

## 🎉 开始使用

**最简单的启动方式：**

1. 双击 `生产环境启动.bat`
2. 选择 `1`（一键启动全部）
3. 等待 Electron 窗口打开
4. 关闭启动提示窗口（可选）
5. 开始使用应用！

**停止应用：**

1. 双击 `生产环境启动.bat`
2. 选择 `4`（停止所有服务）

---

**祝使用愉快！** 🎊
